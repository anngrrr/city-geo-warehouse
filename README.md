# City Geo Warehouse

ETL-???????? ??? ????????????? ????????? ?????? ?? ?????????? ????????? API (GeoDB, Teleport, OpenWeatherMap, OpenStreetMap). ?????? ?????????? Pydantic v2 ??? ????????? ?????? ? SQLAlchemy 2.x ??? ?????? ? PostgreSQL.

## ????????? ???????

```
.
+-- docker
¦   +-- Dockerfile
¦   +-- init.sql
+-- notebooks
¦   +-- city_data_etl.ipynb
+-- src
¦   +-- config
¦   ¦   +-- api_config.py
¦   +-- models
¦   ¦   +-- city_data.py
¦   ¦   +-- city_data_collector.py
¦   ¦   +-- city_etl.py
¦   ¦   +-- natural_features.py
¦   +-- utils
¦       +-- validators.py
+-- .env
+-- Makefile
+-- README.md
+-- requirements.txt
+-- docker-compose.yml
```

## ?????????? ?????????

1. **???????? ??????????? ????????? ? ?????????? ???????????**
   ```bash
   python -m venv .venv
   # Windows
   .venv\Scripts\activate
   # Linux/macOS
   source .venv/bin/activate
   pip install --upgrade pip
   pip install -r requirements.txt
   ```

2. **????????? ?????????? ?????????**
   ? ????? `.env` ??????? ??????? ? PostgreSQL ? ????? API:
   ```env
   POSTGRES_USER=postgres
   POSTGRES_PASSWORD=your_password
   POSTGRES_DB=city_metrics
   POSTGRES_PORT=5432
   DATABASE_URL=postgresql://${POSTGRES_USER}:${POSTGRES_PASSWORD}@localhost:${POSTGRES_PORT}/${POSTGRES_DB}

   OPENWEATHER_API_KEY=your_openweather_api_key
   GEODB_API_KEY=your_geodb_rapidapi_key
   ```

3. **????????? PostgreSQL ? Docker**
   ```bash
   make up
   ```
   ????????? ?????????????? ????? `city_data` ? ??????? `city_metrics` ? ??????? `docker/init.sql`.

## ?????? ETL

?????? ????????????? ? Python:
```python
from src.models.city_etl import CityDataETL

etl = CityDataETL(database_url="postgresql://postgres:your_password@localhost:5432/city_metrics")
cities = [
    {"name": "Berlin", "country": "DE"},
    {"name": "San Francisco", "country": "US"},
]
result_df = etl.run_etl(cities)
print(result_df.head())
```

## ???????? ??????????

- **`CityDataCollector`** — ????????? ????????? ? ??????? API, ??????????? ? ?????????? ?????? ?? ??????.
- **`CityMetrics`** — ?????? Pydantic v2, ???????? ???????? ? ???????? ?????????? ????????.
- **`NaturalFeatureAnalyzer`** — ?????????? OSM ??? ??????? ?????????? ?? ????????? ???????? ? ???? ??????? ???.
- **`CityDataETL`** — ??????????? ETL-??????? ?? SQLAlchemy 2.x ? UPSERT-??????? ? ?????????? ???????? ??????.

## ???????????? ? ???????

- ??? ????????? ???????? ??????????? ??????? `notebooks/city_data_etl.ipynb`.
- ????? ???????? ?????????, ??? ?????? ?????????? API-?????; ????? ???? ?????? ?????????? ? ???????.
- ????? ETL ????? ????????? ?????????? ???????:
  ```bash
  docker-compose exec postgres psql -U ${POSTGRES_USER} -d ${POSTGRES_DB} -c "SELECT COUNT(*) FROM city_data.city_metrics;"
  ```

## ???????

```bash
make down      # ?????????? ?????????
make clean     # ?????????? ? ??????? ?????? PostgreSQL
```

## ????????

MIT License.
